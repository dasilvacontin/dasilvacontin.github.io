<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body class="page-post">

  <!-- <img src="/images/blog.png" style="position: fixed; top: 0; left: -350px; opacity: 0.1; z-index: -1;" /> -->

  <div class="wallpaper">
  <a class="go-home-bar" href="/">&lt; &lt; &lt; back to dasilvacontin's home &lt; &lt; &lt;</a>

  <div class="container">
    <small>
      <img class="avatar" src="/images/avatar.jpg">
      <p>デイビッド</p>
    </small>

    <div class="post">
      <header class="post-header">
        <h1 class="post-title">{{ page.title }}</h1>
        <p class="post-meta">{{ page.date | date: "%B %-d, %Y" }}</p>
        <p class="post-meta">7 min. reading time</p>
      </header>

      <article class="post-content">
        {{ content }}
      </article>
    </div>

    <div>
      <!-- Go to www.addthis.com/dashboard to customize your tools -->
      <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b7595602155b131"></script>
      <!-- AddToAny BEGIN 
      <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
        <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
        <a class="a2a_button_facebook"></a>
        <a class="a2a_button_twitter"></a>
        <a class="a2a_button_linkedin"></a>
        <a class="a2a_button_telegram"></a>
      </div>
      <script async src="https://static.addtoany.com/menu/page.js"></script>
      <!-- AddToAny END -->
    </div>
  </div>

  {% include author-about.html %}

  {% include footer.html %}

  </div><!-- wallpaper -->
  <script>
    let startedPullY = null
    let pullDistance = 0
    let isPulling = false

    function getScreenY (e) {
      return e.pageY - document.body.scrollTop
    }

    function obtainStartPullY (e) {
      const y = getScreenY(e)
      if (document.body.scrollTop === 0 && startedPullY == null) {
        isPulling = true
        startedPullY = y
      }
    }
    
    function updatePullDistance (e) {
      if (isPulling) {
      const y = getScreenY(e)
        pullDistance = (y - startedPullY)
      } else {
        pullDistance = 0
      }
    }

    function checkPullRelease (e) {
      const y = getScreenY(e)
      if (e.touches.length === 0 || y < startedPullY) {
        startedPullY = null
        isPulling = false
        pullDistance = 0
      }
    }

    document.addEventListener('touchstart', function (e) {
      obtainStartPullY(e)
    })
    document.addEventListener('touchmove', function (e) {
      checkPullRelease(e)
      obtainStartPullY(e)
      updatePullDistance(e)
    })
    document.addEventListener('touchend', function (e) {
      checkPullRelease(e)
    })

    const f = Math.floor
    const backHeader = document.getElementsByClassName('go-home-bar')[0]
    const pulledColor = [91, 197, 253]//[59, 209, 253]//[0, 0, 255]
    const dasilvaMagenta = [122, 45, 255] 
    let currentColor = dasilvaMagenta.slice(0)
    let targetColor = dasilvaMagenta.slice(0)

    function updateHeaderColor () {
      requestAnimationFrame(updateHeaderColor)

      const factor = Math.min(1, pullDistance/(window.innerHeight*3/4))
      if (isPulling) {
        targetColor = targetColor.map((_, i) =>
          (pulledColor[i] - dasilvaMagenta[i]) * factor + dasilvaMagenta[i]
        )
      } else {
        targetColor = dasilvaMagenta
      }

      currentColor = currentColor.map((curr, i) =>
        curr + (targetColor[i] - curr) / 5
      )

      const color = `rgb(${f(currentColor[0])}, ${f(currentColor[1])}, ${f(currentColor[2])})`

      document.body.style.background = color
      backHeader.style.background = color

      console.log({top: document.body.scrollTop, isPulling, startedPullY, pullDistance, color})
    }
    requestAnimationFrame(updateHeaderColor)

  </script>
</body>

</html>